---
layout: project
title: Quadcopter Attitude Control System
description: Linearized Dynamics Modeling and Trajectory Optimization
technologies: [MATLAB, System Dynamics, Control Theory, PD Controller, ODE Modeling, 3D Animation]
course: MAE 3260 - System Dynamics
image: /assets/images/quadcopter_animation.png
---

[View Full Report (PDF)](/assets/projects/MAE3260_Final_Groupwork.pdf){: .btn}

As part of MAE 3260 at Cornell University, our team developed a mathematical model and control system for quadcopter attitude stabilization, comparing traditional step input control with smooth exponential trajectory planning. This project synthesized rigid body dynamics, linearization techniques, PD controller design, and 3D visualization to demonstrate the fundamental trade-offs between response speed and smoothness.

## Project Overview

Quadcopters are inherently unstable systems requiring active control to maintain stable flight. This project focused on modeling the attitude control subsystem, which governs rotational motion about three axes: roll (φ), pitch (θ), and yaw (ψ). We developed a simplified linearized model to demonstrate step response behavior and enable classical control analysis techniques.

**Project Objectives:**
- Develop linearized ODEs describing quadcopter attitude dynamics
- Create block diagrams modeling input-output relationships
- Implement PD controller for smooth movement and steering
- Compare hard step vs. exponential trajectory inputs
- Create MATLAB animation demonstrating system behavior
- Validate analytical predictions through simulation

<div style="clear: both;"></div>

## Initial Research & Approach

We began by researching existing quadcopter models and found various approaches, though they varied slightly in their methods. We determined that a linear model was essential to stay within the scope of this project. Since a quadcopter requires 6 degrees of freedom (3 spatial and 3 rotational), we initially planned a state space with 12 entries, including every DOF and its derivative.

We determined it would be most appropriate to model the behavior of a step input from the controller, showing how the quadcopter approaches the desired angle of flight based on user input to the transmitter. For simplicity, we chose a PD controller. While a PID controller would be better for disturbance rejection or precise motion, the PD controller was simpler and sufficient to demonstrate step response and animate the desired motion. LQR controllers were also considered but would further complicate the system without adding significant educational value for this project.

<div style="clear: both;"></div>

## Block Diagram

We created a block diagram for the pitch rate of the quadcopter using a PD controller design. For a complete quadcopter model, we would also need block diagrams for roll, yaw, and vertical acceleration. The only differences between these diagrams would be the P and D gains and the quadcopter dynamics block. 

The diagram shows the feedback loop structure with:
- Commanded angle input
- Error calculation (desired - actual)
- PD controller computing control torque
- Motor dynamics
- Sensor dynamics providing feedback
- Quadcopter rotational dynamics

This diagram doesn't yet include numerical values for settling time, time constants, and inertial characteristics, and doesn't model disturbance torques that would affect real-world operation.

<div style="clear: both;"></div>

## ODE Derivation & Linearization

### Nonlinear Dynamics

The quadcopter attitude dynamics are derived from two principles of rigid body mechanics:

**Euler Angle Kinematics:**
The time derivatives of Euler angles relate to body angular velocities through a nonlinear transformation matrix. This relationship accounts for the fact that these two representations of rotational velocity are not identical except in special cases.

**Euler's Equations of Motion:**
The angular acceleration is governed by Euler's equations for a rigid body:
```
Iₓṗ = (Iᵧ - Iz)qr + τₓ
Iᵧq̇ = (Iz - Iₓ)pr + τᵧ
Izṙ = (Iₓ - Iᵧ)pq + τz
```

Here, Iₓ, Iᵧ, and Iz represent the moments of inertia about the x, y, and z axes. The terms τₓ, τᵧ, and τz represent the applied control torques generated by different motor speeds. The cross-coupling terms represent gyroscopic effects that arise from the conservation of angular momentum.

### Linearization Process

The nonlinear equations are difficult to analyze using classical control techniques such as transfer functions. We linearized the dynamics around the equilibrium point defined by φ = θ = ψ = 0 and p = q = r = 0.

For small deviations from this equilibrium, we applied small angle approximations:
```
sin(x) ≈ x,  cos(x) ≈ 1,  tan(x) ≈ x
```

Applying these approximations to the kinematic equations yielded simplified relationships:
```
φ̇ ≈ p,  θ̇ ≈ q,  ψ̇ ≈ r
```

Additionally, the gyroscopic coupling terms in Euler's equations involve products of angular rates, which become negligible (compared to first-order terms) when angular rates are small. Therefore we can neglect these terms in our linearized model:
```
ṗ ≈ τₓ/Iₓ,  q̇ ≈ τᵧ/Iᵧ,  ṙ ≈ τz/Iz
```

<div style="clear: both;"></div>

## State Space Representation

Our state space has 12 elements, including 3 positions, 3 angles, and the velocity of each of those terms. The state vector X includes:
```
X = [x, y, z, θ, φ, ψ, ẋ, ẏ, ż, θ̇, φ̇, ψ̇]ᵀ
```

This complete representation captures both the translational and rotational degrees of freedom, though our analysis focused primarily on the rotational subsystem for this project.

<div style="clear: both;"></div>

## PD Controller Design

### Control Architecture

We implemented a PD controller for attitude stabilization. The controller consists of three independent single-input single-output loops, one for each rotational axis. This decoupled approach is valid within the linearized regime where cross-coupling effects are negligible. Each control loop measures the current angle and angular velocity, compares the angle to its commanded value, and generates a corrective torque based on both the error and the rate of change.

### Control Law

The control torques are computed using the law:
```
u(t) = Kₚe(t) - Kdy(t)
```

Where:
- **e** represents the angle error vector [rφ - φ, rθ - θ, rψ - ψ]ᵀ
- **y** represents the angular velocity vector [p, q, r]ᵀ
- **Kₚ** is a diagonal matrix of proportional gains
- **Kd** is a diagonal matrix of derivative gains

The proportional term generates torque proportional to the angle error, providing a restoring force that drives the system toward the commanded angle. The larger the error, the stronger the corrective torque. The derivative term generates torque proportional to angular velocity, providing damping by opposing rotational motion. The damping is crucial for reducing overshoot and oscillations that would occur with proportional control alone.

### Closed-Loop Equations

Substituting the control law into the linearized dynamics gives the closed-loop system equations for each axis:

**Roll:**
```
φ̈ = (Kₚφeφ - Kdφφ̇)/Iₓ
→ Iₓφ̈ + Kdφφ̇ + Kₚφφ = Kₚφrφ
```

**Pitch:**
```
θ̈ = (Kₚθeθ - Kdθθ̇)/Iᵧ
→ Iᵧθ̈ + Kdθθ̇ + Kₚθθ = Kₚθrθ
```

**Yaw:**
```
ψ̈ = (Kₚψeψ - Kdψψ̇)/Iz
→ Izψ̈ + Kdψψ̇ + Kₚψψ = Kₚψrψ
```

Where e = r - y (error equals reference minus output).

<div style="clear: both;"></div>

## Trajectory Design & Analysis

### Motivation for Smooth Trajectories

A hard step input, while mathematically simple and providing the fastest theoretical response, creates several practical problems in real-world quadcopter operation:

- The instantaneous discontinuity produces infinite jerk (derivative of acceleration), causing severe mechanical stress on motors
- The aggressive response could produce significant overshoot, which may violate safety constraints in confined spaces
- Passenger discomfort and potential damage to sensitive payloads

To address these fundamental limitations, we developed and compared exponential command input patterns that provide continuous trajectories with controlled acceleration and jerk characteristics.

### Trajectory Patterns

**Hard Step Input:**
```
r(t) = φ·u(t)
```
This serves as our baseline for comparison.

**Exponential Approach:**
```
r(t) = φ(1 - e^(-t/τ))
```
Where time constant τ is selected such that trajectory reaches 99% of the target at time T (requiring T = 5τ).

### Analytical Predictions

We used parameters of **ωₙ = 20 rad/s**, **ζ = 0.5**, and **φ = 30° = 0.524 rad** for analytical predictions.

**Hard Step Input:**

Rise time (10% to 90%):
```
tr = 1.8/ωₙ = 1.8/20 = 0.09 seconds
```

Percent overshoot:
```
MO = 100·e^(-πζ/√(1-ζ²))
   = 100·e^(-π·0.5/√(1-0.25))
   = 16.3%
```

Settling time:
```
ts = 4/(ζ·ωₙ) = 4/(0.5·20) = 0.4 seconds
```

**Exponential Input:**

We selected time constant τ = 0.434 seconds such that the command reaches 99% of target at t = 2 seconds (0.99 = 1 - e^(-2/τ)).

Rise time (10% to 90%):
```
tr = -τ·ln(1 - 0.9)
   = -0.434·ln(0.1)
   = 1.0 second
```

Percent overshoot:
```
MO = 0%
```

Settling time (98% criterion):
```
t₉₈% = -τ·ln(1 - 0.98)
     = -0.434·ln(0.02)
     = 1.7 seconds
```

### Trade-offs Analysis

The predictions reveal clear trade-offs between the two approaches:

- The hard step input provides extremely fast response with a rise time **11.5 times faster** than the exponential approach
- However, this speed comes at the cost of **16.8% overshoot**, which could violate safety constraints
- The settling time advantage is less dramatic, with the step settling only ~4 times faster
- The exponential input sacrifices speed for smoothness and predictability
- The complete elimination of overshoot makes exponential suitable for applications with strict safety margins
- The slower rise time is acceptable for most non-emergency tasks

<div style="clear: both;"></div>

## MATLAB Implementation & Animation

We created a MATLAB script to simulate and animate the quadcopter behavior. We used ChatGPT to help write the code, iterating until we had a model that gave us what we were looking for.

### Implementation Details

The MATLAB script includes:
- **Dynamics function:** Implements nonlinear rigid body dynamics with PD control
- **ODE solver:** Uses ode45 for numerical integration
- **Trajectory generators:** Functions for step and exponential inputs
- **3D animation:** Visualizes quadcopter orientation using rotation matrices

### Animation Results

Sample animation: [View on YouTube](https://youtu.be/I4UrNOWYjr8)

The plot generated by our MATLAB script shows the behavior of each angle over time. This was a good way to check the logic of our code, as it allowed us to clearly see a step response and behavior that we expected.

![Quadcopter attitude animation plot]({{ "/assets/images/quadcopter_attitude_plot.png" | relative_url }}){: .inline-image-c}

Reflecting on our animation, we can see that the quadcopter quickly responds to the input and behaves as expected. The angular acceleration begins quite high, but as the angle approaches the input angle, the proportional control has a smaller input, leading to the behavior displayed in the animation and step response graph.

We can also see that our initial control inputs are quite high due to the high proportional gain of the pitch controller. If this was actually being implemented into a quadcopter, we would need to check that the high effort wouldn't saturate the motor. If it did, this could be fixed by lowering the proportional gain of the pitch controller.

<div style="clear: both;"></div>

## Gain Values & Parameter Effects

Through modifying the chosen gain values and identifying trends, we analyzed how choices within the system affect results. While differences between roll, pitch, and yaw are simply matters of orientation, the differences in rotational inertia cause these orientations to behave differently.

### System Parameters

The quadcopter is modeled with rotational inertias of:
- Iₓ = 0.02 kg·m² (x-axis)
- Iᵧ = 0.02 kg·m² (y-axis)
- Iz = 0.04 kg·m² (z-axis)

### Uniform Gain Testing

We first set Kₚ and Kd gains for all dimensions to 2 and the command angle to 30° for uniformity:

![Uniform gain response]({{ "/assets/images/quadcopter_uniform_gains.png" | relative_url }}){: .inline-image-c}

This result shows that differences in rotational inertia cause the damping ratio of yaw and roll to be approximately the same, with pitch being lower. For quadcopter motion, the most important angles to control are roll and pitch, as yaw rotates the system about the z-axis, which isn't particularly important for piloting except for advanced maneuvers.

To control the system smoothly, we ideally want roll and pitch to behave identically so that translations in x or y axis don't get influenced differently with the same degree of input. However, once we set the yaw command to zero, roll and pitch dimensions behave nearly identically.

![Zero yaw command response]({{ "/assets/images/quadcopter_zero_yaw.png" | relative_url }}){: .inline-image-c}

This discrepancy when yaw is commanded is likely due to the gyroscopic coupling not being symmetric, which causes unequal bleed-over into different rotational axes when a yaw command is inputted. Further research would be required to identify if this phenomenon is important to account for in steering, or if it's a natural part of how we model the system.

<div style="clear: both;"></div>

## Steady State Behavior

For our model of a quadcopter, steady state happens any time the quadcopter is at a fixed angle. This includes when the quadcopter is hovering stationary in the air, or when it is positioned at a fixed angle moving with constant velocity.

Importantly, this means that any time our quadcopter has reached our desired angle with no more angular velocity, it is in steady state. The PD controller ensures zero steady-state error for constant commands, as confirmed by our simulation results showing errors less than 0.03°.

<div style="clear: both;"></div>

## Key Findings

Through this comprehensive analysis, several important conclusions emerged:

**Linearization Validity:**
The analytical predictions closely matched simulation results (within 11% for rise time, 3% for overshoot), validating the linearization approach for angles up to approximately 30°.

**Speed vs. Smoothness Trade-off:**
- Hard step input: 11.5× faster rise time but 16.8% overshoot
- Exponential approach: Zero overshoot with acceptable speed (1.0 s rise time)
- Choice depends on application requirements (emergency vs. normal operations)

**Controller Performance:**
- PD controller successfully stabilized all three axes
- Achieved zero steady-state error (< 0.03°)
- Underdamped gains (ζ = 0.5) clearly demonstrated benefits of smooth trajectories

**Parameter Sensitivity:**
- Rotational inertia differences affect response speed
- Roll and pitch should behave identically for smooth control
- Gyroscopic coupling creates minor discrepancies with simultaneous yaw commands

**Practical Considerations:**
- High proportional gains can saturate motors
- Smooth trajectories reduce mechanical stress
- Exponential approach suitable for passenger comfort and safety constraints

<div style="clear: both;"></div>

## Applications & Impact

This quadcopter control design demonstrates fundamental engineering principles applicable to:

- **Autonomous drones:** Package delivery, aerial photography, surveying
- **Aerospace systems:** Spacecraft attitude control, satellite stabilization
- **Robotics:** Mobile robots, manipulator control, motion planning
- **Industrial automation:** Crane control, positioning systems

The integration of analytical predictions with numerical simulation reflects modern engineering practice, where hand calculations provide insight while computational tools validate detailed behavior.

<div style="clear: both;"></div>

## Team Contributions

**Catherine Guo:**
Contributed to deriving and linearizing ODEs, developing PD controller, and designing inputs.

**Joe Dalton:**
Worked on generating the MATLAB script along with drawing the block diagram for the pitch.

**Kevin Sturm:**
Worked on researching different types of controllers and state space models and comparing their advantages/disadvantages.

**Nuo Xiang Yan:**
Worked on identifying how system parameters affect the resultant rotational motions using the MATLAB script.

<div style="clear: both;"></div>

## Project Details

**Course:** MAE 3260 - System Dynamics, Fall 2025  
**Team:** Catherine Guo, Joe Dalton, Kevin Sturm, Nuo Xiang Yan  
**Institution:** Cornell University, Sibley School of Mechanical and Aerospace Engineering  
**Tools:** MATLAB, ChatGPT (for code assistance), System Dynamics Theory  
**Analysis Methods:** ODE derivation, linearization, transfer functions, numerical simulation  
**Deliverables:** Technical report, MATLAB simulation code, 3D animation, performance analysis  

---

This project represents the application of classical control theory and dynamics to a practical aerospace system—demonstrating the fundamental skills for mechanical engineers designing autonomous vehicles and dynamic systems.